<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Swipe App Container</title>
    <style>
        /* 1. æ­¸é›¶ */
        * { margin: 0; padding: 0; box-sizing: border-box; border: 0; outline: 0; }

        /* 2. èƒŒæ™¯è¨­å®š */
        html, body {
            width: 100%; height: 100%;
            background-color: #F3ECE5; 
            overflow: hidden; /* ç¦æ­¢ Body æ²å‹• */
        }

        /* 3. æ»‘å‹•å®¹å™¨ */
        .app-container {
            display: flex;
            flex-wrap: nowrap;
            width: 100%; 
            height: 100%;
            
            overflow-x: scroll; 
            overflow-y: hidden;
            scroll-snap-type: x mandatory; /* å¼·åˆ¶åˆ†é åœé  */
            
            background-color: #F3ECE5;
            
            /* éš±è—æ²è»¸ */
            scrollbar-width: none; 
            -ms-overflow-style: none;
            -webkit-overflow-scrolling: touch; /* è®“ iOS æ»‘å‹•æ›´é †æš¢ */

            /* â˜…â˜…â˜… æ–°å¢ï¼šé›»è…¦ç‰ˆæ¸¸æ¨™æ¨£å¼ â˜…â˜…â˜… */
            cursor: grab; /* é è¨­é¡¯ç¤ºã€Œæ‰‹æŒã€ */
            user-select: none; /* ç¦æ­¢æ‹–å‹•æ™‚é¸å–æ–‡å­— */
        }
        
        /* ç•¶æŒ‰ä½æ»‘é¼ æ™‚ï¼Œè®Šæˆã€ŒæŠ“å–ä¸­ã€çš„æ‹³é ­ */
        .app-container.active {
            cursor: grabbing;
            scroll-snap-type: none; /* æ‹–å‹•æ™‚æš«æ™‚é—œé–‰å¸é™„ï¼Œæ‰‹æ„Ÿæ¯”è¼ƒå¥½ */
        }

        .app-container::-webkit-scrollbar { display: none; }

        /* 4. iframe è¨­å®š */
        iframe {
            display: block;
            flex: 0 0 100%; 
            width: 100%;
            height: 100%;
            
            border: none !important;
            box-shadow: none !important;
            background-color: #F3ECE5;
            
            scroll-snap-align: center; 
            scroll-snap-stop: always;
            pointer-events: none; /* â˜… é—œéµï¼šè®“æ»‘é¼ äº‹ä»¶èƒ½ç©¿é€ iframe å‚³çµ¦ container */
        }

        /* â˜… ç‰¹æ®Šè™•ç†ï¼šåªæœ‰ç•¶ iframe éœ€è¦äº’å‹•æ™‚æ‰é–‹å•Ÿ pointer-events */
        /* ä½†é€™æ¨£æœƒå°è‡´ iframe å…§éƒ¨ç„¡æ³•é»æ“Šï¼Œç‚ºäº†è§£æ±ºæ¸¬è©¦å•é¡Œï¼Œæˆ‘å€‘ç”¨ JS å‹•æ…‹æ§åˆ¶ pointer-events */
        
    </style>
</head>
<body>
    
    <div class="app-container" id="appContainer">
        <iframe src="memories.html" frameborder="0"></iframe>
        <iframe src="home.html" id="homeFrame" frameborder="0"></iframe>
        <iframe src="social.html" frameborder="0"></iframe>
    </div>

    <script>
        const container = document.getElementById('appContainer');
        const homeFrame = document.getElementById('homeFrame');

        // --- â˜…â˜…â˜… æ–°å¢ï¼šé›»è…¦ç‰ˆæ»‘é¼ æ‹–æ›³åŠŸèƒ½ (Mouse Drag) â˜…â˜…â˜… ---
        let isDown = false;
        let startX;
        let scrollLeft;

        container.addEventListener('mousedown', (e) => {
            // å¦‚æœç›®å‰æ˜¯è¢«é–å®šç‹€æ…‹ (hidden)ï¼Œå°±ä¸å…è¨±æ‹–æ›³
            if(container.style.overflowX === 'hidden') return;

            isDown = true;
            container.classList.add('active');
            startX = e.pageX - container.offsetLeft;
            scrollLeft = container.scrollLeft;
            
            // æš«æ™‚è®“ iframe ä¸æ¥æ”¶äº‹ä»¶ï¼Œé€™æ¨£æ‹–æ›³æ‰ä¸æœƒå¡ä½
            document.querySelectorAll('iframe').forEach(i => i.style.pointerEvents = 'none');
        });

        container.addEventListener('mouseleave', () => {
            isDown = false;
            container.classList.remove('active');
            document.querySelectorAll('iframe').forEach(i => i.style.pointerEvents = 'auto');
        });

        container.addEventListener('mouseup', () => {
            isDown = false;
            container.classList.remove('active');
            
            // æ¢å¾© iframe äº’å‹•
            document.querySelectorAll('iframe').forEach(i => i.style.pointerEvents = 'auto');
            
            // æ¢å¾© CSS snap æ•ˆæœï¼Œè®“ç•«é¢è‡ªå‹•æ­¸ä½
            container.style.scrollSnapType = 'x mandatory'; 
        });

        container.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - container.offsetLeft;
            const walk = (x - startX) * 1.5; // * 1.5 æ˜¯æ»‘å‹•é€Ÿåº¦å€ç‡
            container.scrollLeft = scrollLeft - walk;
        });
        // --- â˜…â˜…â˜… é›»è…¦ç‰ˆåŠŸèƒ½çµæŸ â˜…â˜…â˜… ---


        // 1. åˆå§‹åŒ–å®šä½ (å›åˆ°ä¸­é–“çš„ home.html)
        window.onload = function() {
            setTimeout(() => {
                if(container && homeFrame) {
                    container.scrollTo({
                        left: homeFrame.offsetLeft,
                        behavior: 'auto' 
                    });
                }
            }, 100);
        };

        // ç›£è½ä¾†è‡ª iframe (social.html) çš„è¨Šæ¯
        window.addEventListener('message', function(event) {
            // 1. æ”¶åˆ° "é–å®š" æŒ‡ä»¤
            if (event.data.action === 'lockSwiping') {
                console.log("ğŸ”’ æ”¶åˆ°é–å®šæŒ‡ä»¤");
                container.style.overflowX = 'hidden'; 
            }
            
            // 2. æ”¶åˆ° "è§£é–" æŒ‡ä»¤
            if (event.data.action === 'unlockSwiping') {
                console.log("ğŸ”“ æ”¶åˆ°è§£é–æŒ‡ä»¤");
                container.style.overflowX = 'scroll'; 
            }
        });

        // 2. æ™ºæ…§é–å®šé‚è¼¯
        setInterval(function() {
            let shouldLock = false; 

            try {
                if (homeFrame.contentWindow.location.href) {
                    const currentUrl = homeFrame.contentWindow.location.href.toLowerCase();
                    
                    const lockList = [
                        'login.html', 'signup.html', 'forgot-password.html',
                        'profile.html', 'payment.html', 'otp_verify.html',
                        'reset_password.html', 'search.html', 'edit.html', 
                        'message.html', 'onboarding.html', 'comments.html'
                    ];

                    if (lockList.some(page => currentUrl.includes(page))) {
                        shouldLock = true;
                    }
                }
            } catch (e) { }

            if (shouldLock) {
                if (container.style.overflowX !== 'hidden') {
                    console.log("ğŸ”’ æ™ºæ…§é–å®š");
                    container.style.overflowX = 'hidden';
                    container.scrollTo({ left: homeFrame.offsetLeft, behavior: 'auto' });
                }
            } else {
                if (container.style.overflowX !== 'scroll') {
                    console.log("ğŸ”“ æ™ºæ…§è§£é–");
                    container.style.overflowX = 'scroll';
                }
            }
        }, 100);
    </script>
</body>
</html>
