<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Discover</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: #F3ECE5; /* ç±³è‰²èƒŒæ™¯ */
            color: #8C7B6D;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- é ‚éƒ¨å°èˆª --- */
        .header {
            padding: 15px 24px;
            display: flex;
            align-items: center;
            background-color: #F3ECE5; 
            z-index: 10;
        }
        
        .back-btn {
            width: 40px; height: 40px; border-radius: 50%;
            background-color: rgba(255,255,255,0.6);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; text-decoration: none; color: #5D4D40;
        }

        /* --- Loading --- */
        .loading-container {
            height: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: height 0.2s;
        }
        
        .spinner {
            width: 30px; height: 30px;
            border: 3px solid #ddd; border-top-color: #8C7B6D;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- åˆ—è¡¨å®¹å™¨ --- */
        .list-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px 24px 40px 24px;
            overscroll-behavior-y: contain;
            position: relative;
        }
        .list-container::-webkit-scrollbar { display: none; }

        /* --- é¤å»³å¡ç‰‡ --- */
        .card {
            background-color: white;
            border-radius: 24px;
            overflow: hidden;
            margin-bottom: 24px;
            box-shadow: 0 10px 20px rgba(140, 123, 109, 0.1);
            position: relative;
            height: 320px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .card:active { transform: scale(0.98); }

        .card-img {
            width: 100%; height: 100%; object-fit: cover;
        }

        /* å¡ç‰‡è³‡è¨Šå¡Š */
        .card-info-overlay {
            position: absolute;
            bottom: 10px; left: 0; width: calc(100% - 20px);
            margin: 10px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            padding: 20px;
            border-radius: 16px;
        }

        .card-title { 
            font-size: 20px; 
            font-weight: 800; 
            color: #333; /* æ·±è‰²å­— */
            margin-bottom: 6px; 
        }
        
        .card-subtitle { 
            font-size: 15px; 
            font-weight: 600;
            color: #5D4D40; /* æ·±å’–å•¡è‰² */
        }

        /* --- è©³æƒ…é  (Modal) --- */
        .detail-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #fff;
            z-index: 100;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .detail-modal.active { display: flex; transform: translateY(0); }

        .detail-img-header { width: 100%; height: 350px; position: relative; }
        .detail-main-img { width: 100%; height: 100%; object-fit: cover; }
        
        /* ä¿®æ”¹ï¼šç§»é™¤å³é‚Šçš„æ„›å¿ƒï¼Œåªç•™å·¦é‚Šè¿”å› */
        .detail-nav {
            position: absolute; top: 20px; left: 20px; right: 20px;
            display: flex; justify-content: flex-start; /* é å·¦ */
        }
        .nav-circle {
            width: 40px; height: 40px; border-radius: 50%;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
            display: flex; justify-content: center; align-items: center;
            color: white; cursor: pointer;
        }

        .detail-content {
            padding: 24px;
            background-color: #fff;
            border-radius: 30px 30px 0 0;
            margin-top: -30px;
            position: relative;
            min-height: 500px;
        }

        .detail-header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .detail-title { font-size: 28px; font-weight: 800; color: #000; margin-bottom: 5px; }
        .detail-desc-short { color: #666; font-size: 14px; }
        
        /* å°èˆªæŒ‰éˆ• (ç´™é£›æ©Ÿ) */
        .navigate-btn {
            width: 48px; height: 48px; border-radius: 50%;
            background-color: #F3ECE5;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .navigate-btn svg { 
            fill: #5D4D40; 
            stroke: none;
        }

        .info-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; color: #666; font-size: 14px; }
        .info-icon { width: 18px; text-align: center; font-weight: bold; color: #000; }

        .review-section { margin-top: 30px; display: flex; gap: 15px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: #ccc; flex-shrink: 0; }
        .review-text { font-size: 14px; line-height: 1.6; color: #555; }

        .photo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 30px; }
        .grid-p { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 12px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-item { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }

    </style>
</head>
<body>

    <div class="header">
        <a href="home.html" class="back-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </a>
    </div>

    <div class="loading-container" id="loadingContainer">
        <div class="spinner"></div>
    </div>

    <div class="list-container" id="listContainer"></div>

    <div id="detailModal" class="detail-modal">
        <div class="detail-img-header">
            <img id="modal-img" src="" class="detail-main-img">
            <div class="detail-nav">
                <div class="nav-circle" onclick="closeDetail()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                </div>
            </div>
        </div>

        <div class="detail-content">
            <div class="detail-header-row">
                <div>
                    <div id="modal-title" class="detail-title">Title</div>
                    <div id="modal-subtitle" class="detail-desc-short">Subtitle</div>
                </div>
                <div class="navigate-btn" onclick="openGoogleMap()">
                    <svg width="24" height="24" viewBox="0 0 24 24">
                        <path d="M12 2L4.5 20.29C4.24 20.89 4.88 21.49 5.46 21.16L12 17.5L18.54 21.16C19.12 21.49 19.76 20.89 19.5 20.29L12 2Z"/>
                    </svg>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">ğŸ•’</div>
                <div id="modal-hours">Opened</div>
            </div>
            <div class="info-row">
                <div class="info-icon">ğŸ’²</div>
                <div id="modal-price">Price</div>
            </div>
            <div class="info-row">
                <div class="info-icon">ğŸ“</div>
                <div id="modal-address">Address</div>
            </div>

            <div class="review-section">
                <div class="user-avatar" style="background-image: url('https://i.pravatar.cc/150?img=12'); background-size: cover;"></div>
                <div class="review-text">
                    <b>Mr. White</b><br>
                    é€™å®¶åº—ä½æ–¼é«˜é›„ç…ç”²ä¸€å€‹æ–°çš„æ™¯é»ï¼ŒåŸæœ¬æ˜¯å°å¡‘çš„èµ·å®¶åã€‚è£¡é¢çš„æ“ºè¨­å¾ˆåƒå°ç£æ—©æœŸçš„æˆ¿å­å……æ»¿å¤é¢¨ï¼Œåœ’å€æ•´ç†å¾ˆä¹¾æ·¨ã€‚ç”œé»éå¸¸å¥½åƒï¼Œä¸€å®šè¦è©¦è©¦çœ‹ä»–å€‘çš„æ‹›ç‰Œï¼
                </div>
            </div>

            <div class="photo-grid">
                <img src="https://images.unsplash.com/photo-1555400038-63f5ba517a47?w=300&fit=crop" class="grid-p">
                <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=300&fit=crop" class="grid-p">
                <img src="https://images.unsplash.com/photo-1551024709-8f23befc6f87?w=300&fit=crop" class="grid-p">
                <img src="https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=300&fit=crop" class="grid-p">
            </div>
            
            <div style="height: 50px;"></div>
        </div>
    </div>

    <script>
        // 1. ä¿®æ”¹è³‡æ–™åº«ï¼šåœ¨æ¯å€‹é¤å»³ç‰©ä¸­åŠ å…¥ 'mapLink' æ¬„ä½
    
        const restaurants = [
            { 
                id: 1, 
                title: "ç”œä¸Šå£¹ç”Ÿ", 
                subtitle: "å’–å•¡ç”œé»", 
                img: "./IMG_3535.jpg", 
                hours: "13:00â€“19:00", 
                price: "150 - 350", 
                address: "806é«˜é›„å¸‚å‰é®å€ä¸­å±±ä¸‰è·¯39è™Ÿå››å··28è™Ÿ",
                mapLink: "https://www.google.com/maps/place/%E7%94%9C%E4%B8%8A%E5%A3%B9%E7%94%9F/@22.603733,120.3089927,17z/data=!3m1!4b1!4m6!3m5!1s0x346e03002b735c37:0xd6719b213eca4e2a!8m2!3d22.603733!4d120.3089927!16s%2Fg%2F11m65hjygh?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 2, 
                title: "Cheerful Crew åƒå¦åƒå¦", 
                subtitle: "æ¾³å¼æ—©åˆé¤", 
                img: "./IMG_1940.jpg", 
                hours: "09:00â€“16:00", 
                price: "100 - 250", 
                address: "830é«˜é›„å¸‚é³³å±±å€é³³ç”²ä¸€è¡—129è™Ÿ1æ¨“",
                mapLink: "google.com/maps/place/Cheerful+Crew+åƒå¦åƒå¦ï½œé«˜é›„é³³å±±é…ªæ¢¨æ¾³å¼æ—©åˆé¤/@22.5965531,120.3473093,18.94z/data=!4m6!3m5!1s0x346e1d7d5f889305:0x3b119b347a808710!8m2!3d22.5964661!4d120.3467689!16s%2Fg%2F11r6x7x6gw?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 3, 
                title: "èª°ä¸æ„›å’–å•¡", 
                subtitle: "è‡ªçƒ˜å’–å•¡", 
                img: "./IMG_3604.jpg", 
                hours: "10:05â€“18:50", 
                price: "50 - 150", 
                address: "830é«˜é›„å¸‚é³³å±±å€æµ·æ¶µè·¯563è™Ÿ",
                mapLink: "https://www.google.com/maps/place/%E8%AA%B0%E4%B8%8D%E6%84%9B%E5%92%96%E5%95%A1+%E5%A4%96%E5%B8%B6%E5%92%96%E5%95%A1%E7%B6%93%E7%87%9F%EF%BC%88%E6%9C%80%E5%BE%8C%E9%BB%9E%E9%A4%90%E7%82%BA%E9%96%89%E5%BA%97%E5%89%8D%E4%B8%80%E5%B0%8F%E6%99%82%EF%BC%89%EF%BC%88%E7%84%A1%E6%8F%90%E4%BE%9B%E8%A8%82%E4%BD%8D%E3%80%81%E4%B8%8D%E6%8E%A55%E4%BA%BA%E4%BB%A5%E4%B8%8A%E5%9C%98%E9%AB%94%EF%BC%89%E7%84%A1%E6%8F%90%E4%BE%9BWi-Fi%E3%80%81%E6%8F%92%E5%BA%A7%EF%BC%8C%E6%9C%AC%E5%BA%97%E6%98%AF%E8%87%AA%E7%83%98%E5%92%96%E5%95%A1%C2%B7%E8%B1%86%E5%BA%97/@22.5918435,120.3442123,17z/data=!3m1!4b1!4m6!3m5!1s0x346e1daea57dce3b:0x51a47811fdfe5184!8m2!3d22.5918435!4d120.3442123!16s%2Fg%2F11hp1ns5y9?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 4, 
                title: "Kingmauii é‡‘èŒ‚å®œå’–å•¡", 
                subtitle: " ç¾è¡“åº—", 
                img: "./IMG_3698.jpg", 
                hours: "10:00â€“19:00", 
                price: "200 - 400", 
                address: "804é«˜é›„å¸‚é¼“å±±å€ç¾è¡“æ±äº”è·¯75è™Ÿ",
                mapLink: "https://www.google.com/maps/place/Kingmauii+%E9%87%91%E8%8C%82%E5%AE%9C%E5%92%96%E5%95%A1+%E7%BE%8E%E8%A1%93%E5%BA%97/@22.6587402,120.2932287,17z/data=!3m1!4b1!4m6!3m5!1s0x346e050e257507b1:0xce3b1b39bba8d4c1!8m2!3d22.6587402!4d120.2932287!16s%2Fg%2F11gjx0q8wc?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 5, 
                title: "é»ä»Šå’–å•¡", 
                subtitle: "Relax and chill", 
                img: "./IMG_6207.jpg", 
                hours: "9:00 - 18:00", 
                price: "200 - 400", 
                address: "830é«˜é›„å¸‚é³³å±±å€æµ·æ¶µè·¯360è™Ÿ",
                mapLink: "google.com/maps/place/Kaohsiung+City,+Fengshan+District,+Haihan+Road,+é»ä»Šå’–å•¡/@22.6587402,120.2932287,17z/data=!4m5!3m4!1s0x346e1da36509ebd7:0xefbc954fa95b887d!8m2!3d22.5910968!4d120.345923?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 6, 
                title: "åˆå¤é£Ÿå ‚", 
                subtitle: "æ¥ æ¢“åº—", 
                img: "./IMG_6398.jpg", 
                hours: "11:30â€“14:00 17:00â€“20:00", 
                price: "1 - 200", 
                address: "811é«˜é›„å¸‚æ¥ æ¢“å€å¾·è³¢è·¯592å··30å¼„1è™Ÿ",
                mapLink: "https://www.google.com/maps/place/%E5%88%9D%E5%A4%8F%E9%A3%9F%E5%A0%82-%E6%A5%A0%E6%A2%93%E5%BA%97/@22.7266154,120.3001766,17z/data=!3m1!4b1!4m6!3m5!1s0x346e0f37b39a2a49:0x8181df3310783996!8m2!3d22.7266154!4d120.3001766!16s%2Fg%2F11n8xqb62x?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 7, 
                title: "å¥½æƒ³ç‡’è‚‰", 
                subtitle: "æ¥ æ¢“åº—", 
                img: "./IMG_6433.jpg", 
                hours: "11:30 - 00:00", 
                price: "200 - 400", 
                address: "811é«˜é›„å¸‚æ¥ æ¢“å€å¤§å­¸äºŒåå…­è¡—105è™Ÿ",
                mapLink: "https://www.google.com/maps/place/%E5%A5%BD%E6%83%B3%E7%87%92%E8%82%89%EF%BC%88%E6%A5%A0%E6%A2%93%E5%BA%97%EF%BC%89/@22.7289247,120.2889644,19.99z/data=!4m14!1m7!3m6!1s0x346e0f37b39a2a49:0x8181df3310783996!2z5Yid5aSP6aOf5aCCLealoOaik-W6lw!8m2!3d22.7266154!4d120.3001766!16s%2Fg%2F11n8xqb62x!3m5!1s0x346e0f214c83fb57:0x9fda842f4fb52f5d!8m2!3d22.7290998!4d120.2891781!16s%2Fg%2F11y5nh2qcx?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 8, 
                title: "æˆçœŸå’–å•¡Come True Coffee", 
                subtitle: "é«˜é›„ç¾©äº«åº—", 
                img: "./IMG_6481.jpg", 
                hours: "10:30 - 22:00", 
                price: "200 - 400", 
                address: "804é«˜é›„å¸‚é¼“å±±å€å¤§é †ä¸€è·¯115è™Ÿ4æ¨“",
                mapLink: "https://www.google.com/maps/place/%E6%88%90%E7%9C%9F%E5%92%96%E5%95%A1Come+True+Coffee%E9%AB%98%E9%9B%84%E7%BE%A9%E4%BA%AB%E5%BA%97/@22.6558616,120.3063979,17z/data=!3m2!4b1!5s0x346e04fd749a351b:0xbf5efc801b177c41!4m6!3m5!1s0x346e050a2887015b:0xa14598a4d603ba9f!8m2!3d22.6558616!4d120.3063979!16s%2Fg%2F11r9pyh39f?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 9, 
                title: "ä¸€æ‹¾ä¸‰é¯›é­šç‡’è“å­åº— ", 
                subtitle: "ç”Ÿç”œç”œåœˆ", 
                img: "./IMG_6654.jpg", 
                hours: "13:30 - 19:00", 
                price: "180 - 300", 
                address: "813é«˜é›„å¸‚å·¦ç‡Ÿå€æ–‡è‡ªè·¯357è™Ÿ",
                // â†“â†“â†“ åœ¨é€™è£¡è²¼ä¸Šç¬¬ 6 é–“é¤å»³çš„ Google Maps é€£çµ â†“â†“â†“
                mapLink: "https://www.google.com/maps/place/%E4%B8%80%E6%8B%BE%E4%B8%89%E9%AF%9B%E9%AD%9A%E7%87%92%E8%8F%93%E5%AD%90%E5%BA%97+%23%E7%94%9F%E7%94%9C%E7%94%9C%E5%9C%88%EF%BC%88%E6%9C%80%E5%BE%8C%E9%BB%9E%E9%A4%90%E8%87%B318:00%EF%BC%89/@22.675696,120.308547,21z/data=!4m6!3m5!1s0x346e050d870b0667:0x6a7cf459a273e862!8m2!3d22.6758035!4d120.3086852!16s%2Fg%2F11c1pf_nb8?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            },
            { 
                id: 10, 
                title: "æ™´ã€‚æ™¨Morning Sun", 
                subtitle: "åªæœ‰å¤–å¸¶ï¼Œæ²’æœ‰å…§ç”¨", 
                img: "./IMG_6677.jpg", 
                hours: "12:30 - 20:00", 
                price: "180 - 300", 
                address: "801é«˜é›„å¸‚å‰é‡‘å€æ–‡æ­¦ä¸‰è¡—190è™Ÿ",
                // â†“â†“â†“ åœ¨é€™è£¡è²¼ä¸Šç¬¬ 6 é–“é¤å»³çš„ Google Maps é€£çµ â†“â†“â†“
                mapLink: "https://www.google.com/maps/place/%E6%99%B4%E3%80%82%E6%99%A8Morning+Sun%EF%BD%9C%E5%8F%AA%E6%9C%89%E5%A4%96%E5%B8%B6%EF%BC%8C%E6%B2%92%E6%9C%89%E5%85%A7%E7%94%A8%EF%BD%9C/@22.6208826,120.2981848,20.07z/data=!4m14!1m7!3m6!1s0x346e0480a9ebd505:0x6e4dc1a7cdf0ac43!2z5aSn56uLQemkqA!8m2!3d22.6217077!4d120.2982807!16s%2Fg%2F1td1gr0r!3m5!1s0x346e048617120ad5:0x71ab7a32ca6b997f!8m2!3d22.6208976!4d120.298339!16s%2Fg%2F11gdsf72v1?authuser=0&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" 
            }
        ];

        let currentDetailMapLink = ""; 

        // éš¨æ©Ÿé¸å– 3 é–“é¤å»³
        function getRandomRestaurants() {
            const shuffled = [...restaurants].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 3);
        }

        // æ¸²æŸ“åˆ—è¡¨
        function renderList(data) {
            const container = document.getElementById('listContainer');
            container.innerHTML = '';
            
            data.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card fade-in-item';
                card.style.animationDelay = `${index * 0.1}s`;
                card.onclick = () => openDetail(item);

                card.innerHTML = `
                    <img src="${item.img}" class="card-img" onerror="this.src='https://images.unsplash.com/photo-1555400038-63f5ba517a47?w=800&fit=crop'">
                    <div class="card-info-overlay">
                        <div class="card-title">${item.title}</div>
                        <div class="card-subtitle">${item.subtitle}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // åˆå§‹åŒ–æ¸²æŸ“
        renderList(getRandomRestaurants());

        // --- 2. ä¸‹æ‹‰é‡æ–°æ•´ç† (æ”¯æ´ æ‰‹æ©Ÿè§¸æ§ + é›»è…¦æ»‘é¼ ) ---
        const listContainer = document.getElementById('listContainer');
        const loadingContainer = document.getElementById('loadingContainer');
        let startY = 0;
        let isPulling = false;

        // çµ±ä¸€å–å¾— Y åº§æ¨™ (ç›¸å®¹æ»‘é¼ èˆ‡æ‰‹æŒ‡)
        function getY(e) {
            return e.touches ? e.touches[0].clientY : e.clientY;
        }

        // é–‹å§‹æ‹–æ›³
        function startDrag(e) {
            // åªæœ‰ç•¶æ²è»¸åœ¨æœ€é ‚ç«¯æ™‚ï¼Œæ‰å…è¨±ä¸‹æ‹‰
            if (listContainer.scrollTop <= 0) {
                startY = getY(e);
                isPulling = true;
            } else {
                isPulling = false;
            }
        }

        // æ‹–æ›³ä¸­
        function moveDrag(e) {
            if (!isPulling) return;
            const currentY = getY(e);
            const diff = currentY - startY;

            // å¦‚æœå‘ä¸‹æ‹‰ (diff > 0)
            if (diff > 0) {
                // å¦‚æœæ˜¯æ‰‹æ©Ÿè§¸æ§ï¼Œé˜²æ­¢åŸç”Ÿæ²å‹•å¹²æ“¾
                if (e.cancelable && e.type === 'touchmove') {
                    e.preventDefault(); 
                }
                
                // é™åˆ¶æœ€å¤§æ‹‰å‹•è·é›¢ (è¦–è¦ºæ•ˆæœ)
                if (diff < 200) {
                    loadingContainer.style.height = `${diff / 2.5}px`; 
                }
            } else {
                // å¦‚æœå¾€ä¸Šæ¨ï¼Œå°±å–æ¶ˆä¸‹æ‹‰ç‹€æ…‹
                isPulling = false;
            }
        }

        // çµæŸæ‹–æ›³
        function endDrag(e) {
            if (!isPulling) return;
            isPulling = false;

            // æª¢æŸ¥ loading å€å¡Šçš„é«˜åº¦ï¼Œå¦‚æœæ‹‰å¾—å¤ é•· (å¤§æ–¼ 40px)
            const currentHeight = parseInt(loadingContainer.style.height || 0);
            
            if (currentHeight > 40) {
                // å›ºå®šé«˜åº¦ï¼Œé–‹å§‹è½‰åœˆ
                loadingContainer.style.height = '60px'; 
                
                // æ¨¡æ“¬ç¶²è·¯è®€å– 1 ç§’
                setTimeout(() => {
                    renderList(getRandomRestaurants()); // é‡æ–°éš¨æ©ŸæŠ“å–
                    loadingContainer.style.height = '0px'; // æ”¶èµ·
                }, 1000); 
            } else { 
                // æ‹‰ä¸å¤ é•·ï¼Œç›´æ¥å½ˆå›å»
                loadingContainer.style.height = '0px'; 
            }
        }

        // ç¶å®šè§¸æ§äº‹ä»¶ (æ‰‹æ©Ÿ)
        listContainer.addEventListener('touchstart', startDrag, { passive: true });
        listContainer.addEventListener('touchmove', moveDrag, { passive: false }); // é—œéµï¼špassive: false æ‰èƒ½ preventDefault
        listContainer.addEventListener('touchend', endDrag);

        // ç¶å®šæ»‘é¼ äº‹ä»¶ (é›»è…¦)
        listContainer.addEventListener('mousedown', startDrag);
        listContainer.addEventListener('mousemove', moveDrag);
        listContainer.addEventListener('mouseup', endDrag);
        listContainer.addEventListener('mouseleave', endDrag); // æ»‘é¼ ç§»å‡ºç¯„åœä¹Ÿè¦çµæŸ

        // --- 3. è©³æƒ…é  (Modal) é‚è¼¯ ---
        const modal = document.getElementById('detailModal');

        function openDetail(item) {
            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-img').onerror = function() {
                this.src = 'https://images.unsplash.com/photo-1555400038-63f5ba517a47?w=800&fit=crop';
            };
            
            document.getElementById('modal-title').innerText = item.title;
            document.getElementById('modal-subtitle').innerText = item.subtitle;
            document.getElementById('modal-hours').innerText = item.hours + " Opened";
            document.getElementById('modal-price').innerText = item.price;
            document.getElementById('modal-address').innerText = item.address;
            
            currentDetailMapLink = item.mapLink; 

            modal.style.display = 'flex';
            setTimeout(() => { modal.classList.add('active'); }, 10);
        }

        function closeDetail() {
            modal.classList.remove('active');
            setTimeout(() => { modal.style.display = 'none'; }, 300);
        }

        function openGoogleMap() {
            if (currentDetailMapLink) {
                window.open(currentDetailMapLink, '_blank');
            } else {
                alert("æ­¤é¤å»³å°šæœªè¨­å®šåœ°åœ–é€£çµ");
            }
        }
        
    </script>
</body>
</html>
