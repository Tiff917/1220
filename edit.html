<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>New Post with Tagging</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #f0f2f5; padding: 20px; max-width: 600px; margin: 0 auto; min-height: 100vh; }
        
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { margin-bottom: 20px; color: #1f2937; }

        /* --- ä¸Šå‚³èˆ‡ç©ºç‹€æ…‹ --- */
        #placeholder { border: 2px dashed #ddd; border-radius: 12px; padding: 40px; text-align: center; color: #888; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 200px; transition: all 0.3s; }
        .upload-icon { font-size: 40px; margin-bottom: 10px; }
        .upload-btn { margin-top: 15px; display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #eef2ff; color: #4f46e5; border-radius: 25px; cursor: pointer; font-weight: 600; transition: background 0.2s; }
        .upload-btn:active { transform: scale(0.98); background: #e0e7ff; }

        /* --- æ§åˆ¶åˆ— (é ç¢¼ + é¸å–æŒ‰éˆ•) --- */
        .controls-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; display: none; /* åˆå§‹éš±è— */ }
        .page-indicator { font-size: 13px; color: #6b7280; background: #f3f4f6; padding: 4px 10px; border-radius: 12px; }
        
        .btn-toggle-select {
            background: #f3f4f6; color: #4b5563; border: none; 
            padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 500;
            cursor: pointer; display: flex; align-items: center; gap: 6px; 
            transition: all 0.2s;
        }
        .btn-toggle-select:active { transform: scale(0.95); }
        /* é¸å–æ¨¡å¼é–‹å•Ÿæ™‚çš„æ¨£å¼ */
        .btn-toggle-select.active { background: #dbeafe; color: #2563eb; }

        /* --- ç…§ç‰‡é è¦½æ»‘å‹•å€ --- */
        #previewSlider { display: flex; overflow-x: auto; gap: 8px; padding-bottom: 5px; scroll-behavior: smooth; display: none; scrollbar-width: none; }
        #previewSlider::-webkit-scrollbar { display: none; }
        
        /* ç…§ç‰‡å¡ç‰‡ */
        .preview-item { flex: 0 0 33%; position: relative; border-radius: 8px; overflow: hidden; aspect-ratio: 1/1; transition: transform 0.2s; cursor: pointer; }
        .preview-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        /* é¸å–æ¨¡å¼ä¸‹çš„äº’å‹• */
        .preview-item.select-mode:active { transform: scale(0.95); }

        /* é®ç½©å±¤ (æœªé¸æ™‚é€æ˜ï¼Œé¸ä¸­æ™‚è®Šæš—) */
        .img-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.4); opacity: 0; transition: opacity 0.2s; pointer-events: none; }
        .preview-item.selected .img-overlay { opacity: 1; }

        /* å‹¾é¸åœˆåœˆ (å³ä¸Šè§’) */
        .check-icon { 
            position: absolute; top: 6px; right: 6px; 
            width: 20px; height: 20px; 
            border-radius: 50%; 
            border: 2px solid rgba(255,255,255,0.8); 
            display: none; /* éé¸å–æ¨¡å¼éš±è— */
            justify-content: center; align-items: center; 
            background: rgba(0,0,0,0.2); 
            transition: all 0.2s;
        }
        .select-mode .check-icon { display: flex; } /* é–‹å•Ÿæ¨¡å¼æ™‚é¡¯ç¤º */
        
        /* é¸ä¸­å¾Œçš„å‹¾å‹¾æ¨£å¼ (è®Šæ·±è‰²èƒŒæ™¯) */
        .preview-item.selected .check-icon { background: #2563eb; border-color: #2563eb; }
        .preview-item.selected .check-icon svg { opacity: 1; }
        .check-icon svg { width: 12px; height: 12px; color: white; opacity: 0; transition: opacity 0.2s; }

        /* --- [æ–°å¢] æœ‹å‹æ¨™è¨»å€ --- */
        #friendSection { margin-top: 25px; display: none; }
        .section-title { font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 10px; }
        
        .friend-list { display: flex; gap: 16px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .friend-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; min-width: 56px; }
        
        /* é ­åƒå®¹å™¨ */
        .avatar-wrapper { position: relative; width: 50px; height: 50px; }
        .avatar-img { width: 100%; height: 100%; border-radius: 50%; background: #e5e7eb; object-fit: cover; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        
        /* â˜…â˜…â˜… æœ‹å‹æ¨™è¨»åœˆåœˆ (é—œéµåŠŸèƒ½) â˜…â˜…â˜… */
        .tag-circle { 
            position: absolute; bottom: 0; right: 0; 
            width: 16px; height: 16px; 
            border-radius: 50%; 
            border: 2px solid white; 
            background-color: transparent; /* é è¨­ï¼šé€æ˜ */
            border-color: #9ca3af;         /* é è¨­ï¼šç°è‰²é‚Šæ¡† */
            transition: all 0.2s ease;
        }
        
        /* è¢«æ¨™è¨»ç‹€æ…‹ (è®Šæ·±è‰²å¯¦å¿ƒ) */
        .friend-item.tagged .tag-circle {
            background-color: #2563eb; /* è—è‰²å¯¦å¿ƒ */
            border-color: white;
        }
        
        /* åå­—è®Šè‰² */
        .friend-name { font-size: 12px; margin-top: 5px; color: #6b7280; transition: color 0.2s; }
        .friend-item.tagged .friend-name { color: #2563eb; font-weight: 600; }

        /* --- åœ°é»èˆ‡ç™¼å¸ƒ --- */
        #locationContainer { display: none; align-items: center; gap: 10px; margin-top: 20px; padding: 12px; background: #f9fafb; border-radius: 8px; }
        #locationInput { border: none; background: transparent; flex: 1; outline: none; font-size: 14px; color: #374151; }
        
        #shareBtn { width: 100%; margin-top: 25px; padding: 14px; background: #2563eb; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; opacity: 0.5; pointer-events: none; transition: opacity 0.2s; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2); }
        #shareBtn:not(:disabled) { opacity: 1; pointer-events: auto; }
        #shareBtn:active { transform: scale(0.98); }

        /* é‡é¸æŒ‰éˆ• (éš±è— input ç”¨) */
        .hidden-input { display: none; }
        
        canvas { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>å»ºç«‹è²¼æ–‡</h2>
    
    <div id="placeholder">
        <div class="upload-icon">ğŸ“·</div>
        <p style="color:#6b7280; font-size:15px;">åˆ†äº«ä½ çš„ç²¾å½©æ™‚åˆ»</p>
        <label class="upload-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
            é¸æ“‡ç…§ç‰‡
            <input type="file" id="imageLoader" accept="image/*" multiple class="hidden-input">
        </label>
    </div>

    <div id="controlsHeader" class="controls-header">
        <span id="pageIndicator" class="page-indicator">0/0</span>
        
        <button id="multiSelectBtn" class="btn-toggle-select">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
            é¸å–å¤šå¼µ
        </button>
    </div>

    <div id="previewSlider"></div>

    <div id="friendSection">
        <div class="section-title">æ¨™è¨»æœ‹å‹</div>
        <div class="friend-list" id="friendListContainer">
            </div>
        <hr style="border: 0; border-top: 1px solid #e5e7eb; margin-top: 15px;">
    </div>

    <div id="locationContainer">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
        <input type="text" id="locationInput" placeholder="æ–°å¢åœ°é» (é¸å¡«)">
    </div>

    <button id="shareBtn" disabled>ç™¼å¸ƒè²¼æ–‡</button>
</div>

<canvas id="compressCanvas"></canvas>

<script>
    // --- IndexedDB Setup (ä¿ç•™åŸåŠŸèƒ½) ---
    const dbName = "MemoriesDB";
    const storeName = "posts_timeline";
    let db;

    function initDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(dbName, 2);
            request.onupgradeneeded = (e) => {
                db = e.target.result;
                if (!db.objectStoreNames.contains(storeName)) db.createObjectStore(storeName);
            };
            request.onsuccess = (e) => { db = e.target.result; resolve(db); };
            request.onerror = (e) => reject(e);
        });
    }

    function getTimeline() {
        return new Promise((resolve) => {
            if (!db) return resolve([]);
            const tx = db.transaction([storeName], "readonly");
            const store = tx.objectStore(storeName);
            const req = store.get("feed_data");
            req.onsuccess = (e) => resolve(e.target.result || []);
            req.onerror = () => resolve([]);
        });
    }

    function saveTimeline(data) {
        return new Promise((resolve, reject) => {
            const tx = db.transaction([storeName], "readwrite");
            const store = tx.objectStore(storeName);
            const req = store.put(data, "feed_data");
            req.onsuccess = () => resolve();
            req.onerror = () => reject();
        });
    }

    // --- DOM Elements ---
    const imageLoader = document.getElementById('imageLoader');
    const placeholder = document.getElementById('placeholder');
    const previewSlider = document.getElementById('previewSlider');
    const controlsHeader = document.getElementById('controlsHeader');
    const multiSelectBtn = document.getElementById('multiSelectBtn');
    const pageIndicator = document.getElementById('pageIndicator');
    const friendSection = document.getElementById('friendSection');
    const friendListContainer = document.getElementById('friendListContainer');
    const locationContainer = document.getElementById('locationContainer');
    const locationInput = document.getElementById('locationInput');
    const shareBtn = document.getElementById('shareBtn');
    const compressCanvas = document.getElementById('compressCanvas');
    const ctx = compressCanvas.getContext('2d');

    // --- ç‹€æ…‹è®Šæ•¸ ---
    let pendingImages = [];     // æ‰€æœ‰ä¸Šå‚³åœ–ç‰‡çš„ Base64
    let selectedIndices = [];   // è¢«é¸ä¸­çš„åœ–ç‰‡ç´¢å¼• (å¤šé¸æ¨¡å¼ç”¨)
    let isSelectMode = false;   // æ˜¯å¦è™•æ–¼å¤šé¸æ¨¡å¼
    let taggedFriendIds = [];   // è¢«æ¨™è¨»çš„æœ‹å‹ ID

    // æ¨¡æ“¬æœ‹å‹è³‡æ–™
    const friendsData = [
        { id: 1, name: 'å°æ˜', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix' },
        { id: 2, name: 'é›…å©·', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka' },
        { id: 3, name: 'å»ºåœ‹', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Bob' },
        { id: 4, name: 'ç¾ç¾', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jess' },
        { id: 5, name: 'é˜¿è±ª', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jack' }
    ];

    // --- 1. åœ–ç‰‡è™•ç†èˆ‡ä¸Šå‚³ ---
    imageLoader.addEventListener('change', async function(e) {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;

        placeholder.innerHTML = `<div style="opacity:0.6; margin-top:20px;">è™•ç† ${files.length} å¼µç…§ç‰‡ä¸­...</div>`;
        pendingImages = [];
        selectedIndices = [];
        previewSlider.innerHTML = '';

        for (const file of files) {
            try {
                const base64 = await processImage(file);
                pendingImages.push(base64);
            } catch (err) { console.error(err); }
        }

        if (pendingImages.length > 0) {
            // å‰›ä¸Šå‚³å®Œï¼Œé‡ç½®ç‹€æ…‹
            isSelectMode = false;
            selectedIndices = []; 
            multiSelectBtn.classList.remove('active');
            multiSelectBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg> é¸å–å¤šå¼µ`;

            // UI é¡¯ç¤ºåˆ‡æ›
            placeholder.style.display = 'none';
            controlsHeader.style.display = 'flex';
            previewSlider.style.display = 'flex';
            friendSection.style.display = 'block'; // é¡¯ç¤ºæœ‹å‹å€
            locationContainer.style.display = 'flex';
            shareBtn.disabled = false;

            renderPreview();
            renderFriends(); // æ¸²æŸ“æœ‹å‹åˆ—è¡¨
            updatePageIndicator();
        } else {
            resetSelection();
        }
    });

    function processImage(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    let maxWidth = 1080;
                    let w = img.width; let h = img.height;
                    if (w > maxWidth) { h *= maxWidth / w; w = maxWidth; }
                    compressCanvas.width = w; compressCanvas.height = h;
                    ctx.drawImage(img, 0, 0, w, h);
                    resolve(compressCanvas.toDataURL('image/jpeg', 0.85));
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    // --- 2. æ¸²æŸ“é‚è¼¯ ---

    // æ¸²æŸ“ç…§ç‰‡é è¦½ (åŒ…å«é®ç½©èˆ‡æ‰“å‹¾)
    function renderPreview() {
        previewSlider.innerHTML = pendingImages.map((src, index) => {
            const isSelected = selectedIndices.includes(index);
            // å‹•æ…‹ class
            const classes = `preview-item ${isSelectMode ? 'select-mode' : ''} ${isSelected ? 'selected' : ''}`;
            
            return `
                <div class="${classes}" onclick="handleImageClick(${index})">
                    <img src="${src}">
                    <div class="img-overlay"></div>
                    <div class="check-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </div>
                </div>
            `;
        }).join('');
    }

    // æ¸²æŸ“æœ‹å‹åˆ—è¡¨ (åŒ…å«åœˆåœˆè®Šè‰²é‚è¼¯)
    function renderFriends() {
        friendListContainer.innerHTML = friendsData.map(friend => {
            const isTagged = taggedFriendIds.includes(friend.id);
            return `
                <div class="friend-item ${isTagged ? 'tagged' : ''}" onclick="toggleFriendTag(${friend.id})">
                    <div class="avatar-wrapper">
                        <img class="avatar-img" src="${friend.avatar}">
                        <div class="tag-circle"></div>
                    </div>
                    <span class="friend-name">${friend.name}</span>
                </div>
            `;
        }).join('');
    }

    // --- 3. äº’å‹•é‚è¼¯ ---

    // åˆ‡æ›é¸å–æ¨¡å¼
    multiSelectBtn.addEventListener('click', () => {
        isSelectMode = !isSelectMode;
        
        if (isSelectMode) {
            // é–‹å•Ÿæ¨¡å¼
            multiSelectBtn.classList.add('active');
            multiSelectBtn.innerHTML = `å–æ¶ˆé¸å–`; // ç°¡åŒ–æ–‡å­—
            // å¯ä»¥é¸æ“‡é è¨­æ¸…ç©ºé¸å–ï¼Œæˆ–ä¿æŒ
            selectedIndices = [];
        } else {
            // é—œé–‰æ¨¡å¼
            multiSelectBtn.classList.remove('active');
            multiSelectBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg> é¸å–å¤šå¼µ`;
            selectedIndices = [];
        }
        
        renderPreview();
        updatePageIndicator();
    });

    // é»æ“Šç…§ç‰‡
    window.handleImageClick = (index) => {
        if (!isSelectMode) return; // å¦‚æœä¸æ˜¯é¸å–æ¨¡å¼ï¼Œä¸åšäº‹ (æˆ–å¯åšæ”¾å¤§)

        if (selectedIndices.includes(index)) {
            selectedIndices = selectedIndices.filter(i => i !== index);
        } else {
            selectedIndices.push(index);
        }
        renderPreview();
        updatePageIndicator();
    };

    // é»æ“Šæœ‹å‹ (åˆ‡æ›æ¨™è¨»ç‹€æ…‹)
    window.toggleFriendTag = (id) => {
        if (taggedFriendIds.includes(id)) {
            taggedFriendIds = taggedFriendIds.filter(fid => fid !== id);
        } else {
            taggedFriendIds.push(id);
        }
        renderFriends(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–° CSS class
    };

    // æ›´æ–°é ç¢¼æŒ‡ç¤ºå™¨
    previewSlider.addEventListener('scroll', updatePageIndicator);
    function updatePageIndicator() {
        if (pendingImages.length === 0) return;
        
        if (isSelectMode) {
            // é¸å–æ¨¡å¼ä¸‹é¡¯ç¤ºé¸å–æ•¸é‡
            pageIndicator.textContent = selectedIndices.length > 0 
                ? `å·²é¸ ${selectedIndices.length} å¼µ` 
                : 'è«‹é¸æ“‡ç…§ç‰‡';
            pageIndicator.style.background = selectedIndices.length > 0 ? '#dbeafe' : '#f3f4f6';
            pageIndicator.style.color = selectedIndices.length > 0 ? '#1d4ed8' : '#6b7280';
        } else {
            // ä¸€èˆ¬æ¨¡å¼é¡¯ç¤ºæ»‘å‹•é ç¢¼ (ç°¡æ˜“è¨ˆç®—)
            const index = Math.round(previewSlider.scrollLeft / previewSlider.offsetWidth * 3); // æ¦‚ç•¥ä¼°ç®—
            pageIndicator.textContent = `å…± ${pendingImages.length} å¼µ`;
            pageIndicator.style.background = '#f3f4f6';
            pageIndicator.style.color = '#6b7280';
        }
    }

    function resetSelection() {
        pendingImages = [];
        selectedIndices = [];
        taggedFriendIds = [];
        isSelectMode = false;
        
        imageLoader.value = "";
        previewSlider.style.display = 'none';
        controlsHeader.style.display = 'none';
        friendSection.style.display = 'none';
        locationContainer.style.display = 'none';
        locationInput.value = "";
        
        placeholder.style.display = 'flex';
        placeholder.innerHTML = `<div class="upload-icon">ğŸ“·</div><p>åˆ†äº«ä½ çš„ç²¾å½©æ™‚åˆ»</p><label class="upload-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg> é¸æ“‡ç…§ç‰‡<input type="file" id="imageLoader" accept="image/*" multiple class="hidden-input"></label>`;
        shareBtn.disabled = true;
    }

    // --- 4. ç™¼å¸ƒåŠŸèƒ½ ---
    shareBtn.addEventListener('click', async () => {
        // æ±ºå®šè¦ç™¼å¸ƒçš„ç…§ç‰‡ï¼š
        // 1. å¦‚æœæœ‰é¸å– (ä¸”åœ¨é¸å–æ¨¡å¼)ï¼Œåªç™¼é¸å–çš„
        // 2. å¦‚æœæ²’é¸å– (æˆ–ä¸åœ¨æ¨¡å¼)ï¼Œç™¼å…¨éƒ¨
        let imagesToPost = [];
        
        if (isSelectMode && selectedIndices.length > 0) {
            imagesToPost = pendingImages.filter((_, i) => selectedIndices.includes(i));
        } else if (isSelectMode && selectedIndices.length === 0) {
            alert("åœ¨é¸å–æ¨¡å¼ä¸‹ï¼Œè«‹è‡³å°‘é¸æ“‡ä¸€å¼µç…§ç‰‡ï¼Œæˆ–å–æ¶ˆé¸å–æ¨¡å¼ä»¥ç™¼å¸ƒå…¨éƒ¨ã€‚");
            return;
        } else {
            imagesToPost = pendingImages;
        }

        if (imagesToPost.length === 0) return;

        shareBtn.textContent = "ç™¼å¸ƒä¸­...";
        shareBtn.disabled = true;

        if (!db) await initDB();
        let timeline = await getTimeline();
        const now = new Date();
        const dateStr = `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
        const locationText = locationInput.value.trim();
        
        // ç²å–è¢«æ¨™è¨»æœ‹å‹çš„å®Œæ•´è³‡æ–™
        const taggedFriendsInfo = friendsData.filter(f => taggedFriendIds.includes(f.id));

        const newPost = {
            id: Date.now(),
            timestamp: now.getTime(),
            dateString: dateStr,
            images: imagesToPost,
            location: locationText || null,
            taggedFriends: taggedFriendsInfo, // â˜… å„²å­˜æ¨™è¨»è³‡æ–™
            likes: 0,
            isLiked: false,
            comments: []
        };

        timeline.unshift(newPost);

        try {
            await saveTimeline(timeline);
            alert("ç™¼å¸ƒæˆåŠŸï¼");
            window.location.href = "social.html"; // æ ¹æ“šä½ çš„éœ€æ±‚è·³è½‰
        } catch (err) {
            console.error(err);
            alert("ç™¼å¸ƒå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
            shareBtn.textContent = "ç™¼å¸ƒè²¼æ–‡";
            shareBtn.disabled = false;
        }
    });

    initDB();
</script>
</body>
</html>
